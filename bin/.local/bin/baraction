#!/usr/bin/env bash

sleep_sec=2

bg_def="+@bg=0;"
bg_blk="+@bg=1;"
bg_red="+@bg=2;"
bg_grn="+@bg=3;"
bg_ylw="+@bg=4;"
bg_blu="+@bg=5;"
bg_mag="+@bg=6;"
bg_cyn="+@bg=7;"
bg_wht="+@bg=8;"

fg_def="+@fg=0;"
fg_blk="+@fg=1;"
fg_red="+@fg=2;"
fg_grn="+@fg=3;"
fg_ylw="+@fg=4;"
fg_blu="+@fg=5;"
fg_mag="+@fg=6;"
fg_cyn="+@fg=7;"
fg_wht="+@fg=8;"

get_volume () {
	local volume="$(pulsemixer --get-volume)"
	local mute="$(pulsemixer --get-mute)"
	local mute_message="${fg_red}muted${fg_def}"

	if [ $mute -eq 1 ]; then
		local vol="$mute_message"
	else
		local vol="${fg_blu}${volume% *}${fg_def}"
	fi

	echo "$vol"
}

while :; do
	volume="$(get_volume)"
	vpn_status="$(nmcli con show --active | grep -qw "vpn" && echo "${fg_grn}connected${fg_def}" || echo "${fg_red}disconnected${fg_def}")"

	echo -e "Vol%: $volume | VPN: $vpn_status |"
	sleep $sleep_sec
done
