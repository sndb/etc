#!/usr/bin/env bash

sleep_sec=2

bg_def="+@bg=0;"
bg_blk="+@bg=1;"
bg_red="+@bg=2;"
bg_grn="+@bg=3;"
bg_ylw="+@bg=4;"
bg_blu="+@bg=5;"
bg_mag="+@bg=6;"
bg_cyn="+@bg=7;"
bg_wht="+@bg=8;"

fg_def="+@fg=0;"
fg_blk="+@fg=1;"
fg_red="+@fg=2;"
fg_grn="+@fg=3;"
fg_ylw="+@fg=4;"
fg_blu="+@fg=5;"
fg_mag="+@fg=6;"
fg_cyn="+@fg=7;"
fg_wht="+@fg=8;"

get_volume () {
	local sink_vol=$(pulsemixer --get-volume)
	local sink_mute=$(pulsemixer --get-mute)

	local source_id="source-1"
	local source_vol=$(pulsemixer --id "$source_id" --get-volume)
	local source_mute=$(pulsemixer --id "$source_id" --get-mute)

	local muted="${fg_red}muted${fg_def}"

	if [ $sink_mute -eq 1 ]; then
		local vol="$muted"
	else
		local vol="${fg_blu}${sink_vol}${fg_def}"
	fi

	if [ $source_mute -eq 1 ]; then
		local mic="$muted"
	else
		local mic="${fg_mag}${source_vol}${fg_def}"
	fi

	echo "Vol%: ${vol} | Mic%: ${mic}"
}

while :; do
	volume="$(get_volume)"
	vpn_status="$(pgrep openvpn >/dev/null && echo "${fg_grn}VPN${fg_def}" || echo "${fg_red}VPN${fg_def}")"

	echo -e "$volume | $vpn_status |"
	sleep $sleep_sec
done
